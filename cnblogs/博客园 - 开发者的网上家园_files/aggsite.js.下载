function login(n){var t=location.href;return n&&t.indexOf("#"+n)<0&&(t+="#"+n),location.href="https://passport.cnblogs"+getHostPostfix()+"/login.aspx?ReturnUrl="+encodeURIComponent(t),!1}function logout(){return confirm("确认退出吗？")&&(location.href="https://passport.cnblogs"+getHostPostfix()+"/logout.aspx?ReturnUrl="+location.href),!1}function register(){return location.href="https://passport.cnblogs"+getHostPostfix()+"/register.aspx?ReturnUrl="+location.href,!1}function getHostPostfix(){var n=location.hostname;return n.substring(n.lastIndexOf("."),n.length)}function AjaxPost(n,t,i){$.ajax({url:n,data:t,success:function(n){n.d&&i(n.d)}})}function zzk_go(){var n=encodeURIComponent(document.getElementById("zzk_q").value);window.location="http://zzk.cnblogs.com/s?t=b&w="+n}function zzk_go_enter(n){if(n.keyCode==13)return zzk_go(),!1}function google_search(){return location.href="http://www.google.com/search?q="+encodeURIComponent("site:cnblogs.com "+document.getElementById("google_search_q").value),!1}function google_search_enter(n){if(n.keyCode==13)return google_search(),!1}function DiggIt(n){var t=$("#digg_tip_"+n),i;t.css("color","red").html("提交中...");i={postId:n,voteType:"Digg",isAbandoned:!1};$.ajax({url:"/mvc/vote/VotePost.aspx",data:JSON.stringify(i),success:function(i){i.IsSuccess&&$("#digg_count_"+n).html(parseInt($("#digg_count_"+n).html())+1);t.html(i.Message)},error:function(n){t.html(n.responseText)}})}function DiggPost(n,t){var i=$("#digg_tip_"+t),r;i.css("color","red").html("提交中...");r={blogApp:n,postId:t,voteType:"Digg",isAbandoned:!1};$.ajax({url:"/mvc/vote/VoteBlogPost.aspx",data:JSON.stringify(r),success:function(n){n.IsSuccess&&$("#digg_count_"+t).html(parseInt($("#digg_count_"+t).html())+1);i.html(n.Message)},error:function(n){i.html(n.responseText)}})}function cateShow(n){document.getElementById("cate_content_block_"+n)&&(document.getElementById("cate_content_block_"+n).style.display="block");document.getElementById("cate_item_"+n).className="cate_item_hover"}function cateHidden(n){document.getElementById("cate_content_block_"+n)&&(document.getElementById("cate_content_block_"+n).style.display="none");document.getElementById("cate_item_"+n).className=""}function ShowProgress(){$("#post_list").html('<div id="tips_block"><img src="//common.cnblogs.com/images/loading.gif" alt=""/><\/div>')}function GetNewsList(pageIndex,pageSize){var news_click,urlFormat;window.scrollTo(0,0);news_click=eval("(function(){GetNewsList(1,30);return false;});");$("#posts_refresh").attr("onclick","").attr("title","刷新新闻列表").click(news_click).hide();$("#nav_tab_3").attr("class","current_nav");$("#nav_tab_1,#nav_tab_2").removeAttr("class");$("#posts_refresh_tips").css("color","green").html("更新中...");$("#headline_block").html("");$("#post_list").css("padding-top","20px");ShowProgress();$.ajax({url:"/ws/SiteHomeService.asmx/GetNewsLis",data:"{pageIndex:"+pageIndex+",pageSize:"+pageSize+"}",success:function(n){$("#post_list").html(n.d);$("#posts_refresh_tips").html("");$("#posts_refresh").show()},error:function(){$("#post_list").html("更新数据失败！请重试！")}});urlFormat="#";ShowPager(1500,pageIndex,pageSize,urlFormat,"GetNewsList(")}function close_side_right(){$("#side_right").css("display","none");$("#main").css("margin-right","10px");$("#rss_block").css("right","10px")}function set_a_title(n){var t=$.trim($(n).text());t&&!$(n).attr("title")&&$(n).attr("title",t)}function editorPickStat(){var n=$("#editor_pick_count"),t;n.length>0&&(t=$("#editor_pick_lnk").attr("href"),$.ajax({url:"/aggsite/EditorPickStat",data:'{"url":"'+t+'"}',type:"post",dataType:"text",success:function(t){t&&n.html(" "+t)}}))}function google_analytics(n,t,i,r,u,f,e){n.GoogleAnalyticsObject=u;n[u]=n[u]||function(){(n[u].q=n[u].q||[]).push(arguments)};n[u].l=1*new Date;f=t.createElement(i);e=t.getElementsByTagName(i)[0];f.async=1;f.src=r;e.parentNode.insertBefore(f,e)}function google_ga(){try{google_analytics(window,document,"script","https://www.google-analytics.com/analytics.js","ga");var n="UA-476124-1";location.pathname.startsWith("/news")&&(n="UA-476124-8");ga("create",n,"auto");ga("send","pageview")}catch(t){}}function clearLongCookies(){document.cookie.length>500&&$.ajax({url:"/clearcookies.aspx",type:"post"})}function getAdA1(){$.ajax({url:"https://promotion.aliyun.com/promotion/adv/getAliyunAdv.htm?s=1569688aec3640ec876b7b89637003bf&p=page_1470967088195&pin=pos_1470967088195",type:"get",dataType:"jsonp",jsonp:"cback",jsonpCallback:"jsonpCallbackA1",success:function(n){if(n.success&&n.data.length>0){var u=n.data[0].content.replace(/\'/g,'"'),t=JSON.parse(u),i=t[Math.floor(Math.random()*t.length)],f=$("<img />",{src:i.img,alt:"",width:468,height:60}),r=$("<a />",{href:i.url,target:"_blank"});f.appendTo(r);r.appendTo($("#cnblogs_a1"))}}})}function getAdB1(){try{$.ajax({url:location.protocol+"//a1.cnblogs.com/units/image/B1/creative",type:"get",dataType:"html",success:function(n){$("#cnblogs_b1").html(n)}})}catch(n){}}function getAdT1(){var n=location.protocol+"//a1.cnblogs.com/units/text/T1/creative";$.when($.ajax({url:n,type:"get",dataType:"html",cache:!1}),$.ajax({url:"https://promotion.aliyun.com/promotion/adv/getAliyunAdv.htm?s=1569688aec3640ec876b7b89637003bf&p=page_1470967088195&pin=pos_1470968384085",type:"get",dataType:"jsonp",jsonp:"cback",jsonpCallback:"jsonpCallbackT1Aliyun"})).done(function(n,t){var u=n[0],i=t[0];if(i.success&&i.data.length>0){var e=i.data[0].content.replace(/\'/g,'"'),f=JSON.parse(e),r=f[Math.floor(Math.random()*f.length)],o=r.title.startsWith("【")?"":' style="margin-left:10px"';u+="<ul"+o+'><li><a href="'+r.url+'" target="_blank">'+r.title+"<\/a><\/li><\/ul>"}$("#ad_right_text").html(u)})}function getAdB2(){try{$.ajax({url:location.protocol+"//a1.cnblogs.com/units/image/B2/creative",type:"get",dataType:"html",success:function(n){$("#cnblogs_b2").html(n)}})}catch(n){}}function getAdB3(){try{$.ajax({url:location.protocol+"//a1.cnblogs.com/units/image/B3/creative",type:"get",dataType:"html",success:function(n){$("#cnblogs_b3").html(n)}})}catch(n){}}function getAdB4(){try{$.ajax({url:location.protocol+"//a1.cnblogs.com/units/image/B4/creative",type:"get",dataType:"html",success:function(n){$("#cnblogs_b4").html(n)}})}catch(n){}}function changeForMobile(){$(window).width()<980&&($(".headline a").each(function(){$(this).attr("target","_self")}),$("h3 .titlelnk").each(function(){$(this).attr("target","_self")}),$('#nav_menu a[href="https://ing.cnblogs.com/"]').attr("href","https://ing.cnblogs.com/mobile/home/"))}var JSON,waitingTips,c_enable_dfp,aggSite,FollowingPosts;JSON||(JSON={}),function(){"use strict";function i(n){return n<10?"0"+n:n}function o(n){return e.lastIndex=0,e.test(n)?'"'+n.replace(e,function(n){var t=s[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function u(i,f){var s,l,h,a,v=n,c,e=f[i];e&&typeof e=="object"&&typeof e.toJSON=="function"&&(e=e.toJSON(i));typeof t=="function"&&(e=t.call(f,i,e));switch(typeof e){case"string":return o(e);case"number":return isFinite(e)?String(e):"null";case"boolean":case"null":return String(e);case"object":if(!e)return"null";if(n+=r,c=[],Object.prototype.toString.apply(e)==="[object Array]"){for(a=e.length,s=0;s<a;s+=1)c[s]=u(s,e)||"null";return h=c.length===0?"[]":n?"[\n"+n+c.join(",\n"+n)+"\n"+v+"]":"["+c.join(",")+"]",n=v,h}if(t&&typeof t=="object")for(a=t.length,s=0;s<a;s+=1)typeof t[s]=="string"&&(l=t[s],h=u(l,e),h&&c.push(o(l)+(n?": ":":")+h));else for(l in e)Object.prototype.hasOwnProperty.call(e,l)&&(h=u(l,e),h&&c.push(o(l)+(n?": ":":")+h));return h=c.length===0?"{}":n?"{\n"+n+c.join(",\n"+n)+"\n"+v+"}":"{"+c.join(",")+"}",n=v,h}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,r,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;typeof JSON.stringify!="function"&&(JSON.stringify=function(i,f,e){var o;if(n="",r="",typeof e=="number")for(o=0;o<e;o+=1)r+=" ";else typeof e=="string"&&(r=e);if(t=f,f&&typeof f!="function"&&(typeof f!="object"||typeof f.length!="number"))throw new Error("JSON.stringify");return u("",{"":i})});typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(n,t){var r,u,i=n[t];if(i&&typeof i=="object")for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(u=walk(i,r),u!==undefined?i[r]=u:delete i[r]);return reviver.call(n,t,i)}var j;if(text=String(text),f.lastIndex=0,f.test(text)&&(text=text.replace(f,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse");})}();$.ajaxSetup({type:"post",dataType:"json",contentType:"application/json; charset=utf-8",timeout:8e3});waitingTips='<div id="tips_block"><img src="//common.cnblogs.com/images/waiting.gif" alt=""/><\/div>';c_enable_dfp=!0;aggSite={};aggSite.user={};aggSite.user.getUserInfo=function(){var n="//passport.cnblogs"+getHostPostfix();$.ajax({url:n+"/user/LoginInfo",dataType:"jsonp",success:function(t){$("#span_userinfo").html(t);var i=parseInt($("#current_spaceId").html());i>0&&$.ajax({url:n+"/user/NewMsgCount",data:"spaceUserId="+i,dataType:"jsonp",success:function(n){n&&$("#msg_count").html("("+n+")")}})}})};aggSite.loadPostList=function(n){return window.scrollTo(0,0),$("#posts_refresh").hide(),$("#posts_refresh_tips").css("color","green").html("更新中..."),ShowProgress(),$.ajax({url:n,data:JSON.stringify(aggSiteModel),dataType:"text",success:function(n){$("#post_list").html(n);changeForMobile();$("#posts_refresh_tips").html("");$("#posts_refresh").show()},error:function(){$("#post_list").html("更新数据失败！请重试！")}}),!1};aggSite.loadCategoryPostList=function(n){if(arguments.length>0&&(aggSiteModel.PageIndex=n),n>1)location.hash="#p"+n,$("#main").width()<555&&close_side_right();else if(location.hash){window.location=location.href.substring(0,location.href.indexOf("#"));return}this.loadPostList("/mvc/AggSite/"+aggSiteModel.ItemListActionName+".aspx")};aggSite.loadCommentList=function(n){arguments.length>0&&(aggSiteModel.PageIndex=n);this.loadPostList("/mvc/AggSite/CommentList.aspx")};aggSite.loadHeadlineList=function(n,t){aggSiteModel.PageIndex=n;this.loadPostList("/aggsite/HeadlineList",'{"pageIndex":'+n+',"pageSize":'+t+"}")};aggSite.loadTopViewsPostList=function(n){this.loadPostList("/aggsite/TopViewsPostList",'{"pageIndex":'+n+"}")};aggSite.loadTopDiggsPostList=function(n){this.loadPostList("/aggsite/TopDiggsPostList",'{"pageIndex":'+n+"}")};aggSite.loadSiteHomePosts=function(){};aggSite.loadMyCommentedPosts=function(n){return aggSiteModel.CategoryType!="MyCommented"&&$.ajax({url:"/aggsite/MyCommentedPostCount",dataType:"text",success:function(n){n&&(pagingBuider.TotalCount=n,buildPaging(1))}}),aggSiteModel.CategoryType="MyCommented",$(n).css("font-weight","bold").css("color","red"),!1};aggSite.loadSideRight=function(){$.ajax({url:"/aggsite/SideRight",dataType:"text",success:function(n){$("#side_right_block").html(n);getAdB2();getAdB3();getAdB4()},error:function(){$("#side_right_block").html('<div style="margin: 0 10px 10px">侧边栏加载失败！请重试！<\/div>')}})};aggSite.loadSubCategories=function(){var n=$("#cate_sub_block");n.length>0&&$.ajax({url:"/aggsite/SubCategories",data:'{"cateIds":"'+cateIdList+'"}',dataType:"text",success:function(t){n.html(t)}})};aggSite.loadUserStats=function(){var n=$("#user_stats");n.length>0&&$.ajax({url:"/aggsite/UserStats",type:"get",dataType:"text",success:function(t){n.html(t)}})};aggSite.loadAggStats=function(){var n=$("#site_stats");n.length>0&&$.ajax({url:"/aggsite/AggStats",type:"get",dataType:"text",success:function(t){n.html(t)}})};$(function(){var n,t;changeForMobile();aggSiteModel.CategoryType=="MyFollowing"?(n=new FollowingPosts(aggSiteModel),location.hash.length>1&&n.handleHashChange(),window.onhashchange=function(){n.handleHashChange()},$(".mygroup_list li a").each(function(){var t=$(this).data("group");$(this).on("click",function(){n.load(t,1)})})):location.hash.indexOf("#p")==0&&(t=parseInt(location.hash.substr(2)),t>1&&(aggSite.loadCategoryPostList(t),buildPaging(t)));getAdA1();getAdB1();getAdT1();aggSite.loadSideRight();aggSite.loadUserStats();aggSite.loadAggStats();google_ga()});FollowingPosts=function(n){this.model=n};FollowingPosts.prototype.handleHashChange=function(){var n=this.getGroupIdFromHash(),t=this.getPageIndexFromHash();(n||t>0)&&this.load(n,t)};FollowingPosts.prototype.handleClick=function(n,t){var i=this.getHash(n,t);window.location.hash===i?this.load(n,t):window.location.hash=i};FollowingPosts.prototype.load=function(n,t){this.checkGroup(n);this.setPageIndex(t);this.toggleGroupTab(n);this.fetchPosts()};FollowingPosts.prototype.getHash=function(n,t){return n?"#"+n+"/p"+t:"#p"+t};FollowingPosts.prototype.checkGroup=function(n){this.model.CheckedGroupId=n};FollowingPosts.prototype.setPageIndex=function(n){this.model.PageIndex=n};FollowingPosts.prototype.toggleGroupTab=function(n){$(".mygroup_list li").removeClass("active");n?$("#"+n).addClass("active"):$(".mygroup_list li:first").addClass("active")};FollowingPosts.prototype.fetchPosts=function(){window.scrollTo(0,0);$("#posts_refresh").hide();$("#posts_refresh_tips").css("color","green").html("更新中...");ShowProgress();var n=this.model;return $.ajax({url:"/mvc/AggSite/PostListByGroup.aspx",data:JSON.stringify(this.model),timeout:3e4,contentType:"application/json",success:function(t){t?($("#post_list").html(t.PostList),$("#pager_bottom").html(t.Pager),n.PageIndex>1?($("#pager_top").html(t.Pager),$("#pager_top").show()):$("#pager_top").hide()):($("#post_list").html("没有博客哦:)"),$("#pager_bottom").html(""))},error:function(n){$("#post_list").html("更新数据失败！请重试！错误原因："+n.responseText)},complete:function(){$("#posts_refresh_tips").html("");$("#posts_refresh").show()}}),!1};FollowingPosts.prototype.getGroupIdFromHash=function(){var n=location.hash.match(/#.*\//);return n?n[0].slice(1,-1):""};FollowingPosts.prototype.getPageIndexFromHash=function(){var n=location.hash.match(/\/p\d*$/);return n?n[0].substr(2):1}